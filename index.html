<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<script>

var ум = (function() {
    
    var ум = {
        
        слова: {},
        меткиСлов: {},
        меткаНовогоСлова: 1,
        
        выражения: {},
        меткиВыражений: {},
        меткаНовогоВыражения: 1,
        
        собеседники: {},
        меткиСобеседников: {},
        меткаНовогоСобеседника: 1,
        
        рассказы: {},
        меткаНовогоРассказа: 1,
        
        утверждения: {},
        меткаНовогоУтверждения: 1,
        
        действия: {},
        меткиДействий: {},
        меткаНовогоДействия: 1,
        
        вопросы: {},
        меткиВопросов: {},
        меткаНовогоВопроса: 1,
        
        обстоятельства: {},
        меткиОбстоятельств: {},
        меткаНовогоОбстоятельства: 1,
        
        явления: {},
        меткаНовогоЯвления: 1
        
    }
    
    
    ум.говори = function(имяСобеседника) {
        
        console.log(ум);
        
    }
    
    // Начало: Чтение данных
    
    ум.ответь = function(вопрос) {
        
        for (var номерИсточника in вопрос) {
            
            var источник = вопрос[номерИсточника];
            
            for (var имяСобеседника in источник) {
                
                var частиВопроса = источник[имяСобеседника];
                
                for (var номерЧастиВопроса in частиВопроса) {
                    
                    var частьВопроса = частиВопроса[номерЧастиВопроса];

                    for (var названиеДействия in частьВопроса) {
                        
                        var описаниеДействия = частьВопроса[названиеДействия];
                        
                        var значимостьПодходящихДействий = ум.подбериДействия(названиеДействия);
                        
                        var значимостиПодходящихОбстоятельств = {};

                        for (var вопросительноеСлово in описаниеДействия) {
                            
                            if (ум.меткиСлов[вопросительноеСлово] === undefined) {
                                throw new Error("Неизвестное вопросительное слово: " + вопросительноеСлово);
                            }

                            var меткаВыраженияВопроса = ум.меткиВыражений[вопросительноеСлово];
                       
                            if (ум.меткиВопросов[меткаВыраженияВопроса] === undefined) {
                                throw new Error("Не ясно употребление слова в качестве вопросительного: " + вопросительноеСлово);
                            }
                            
                            var меткаВопроса = ум.меткиВопросов[меткаВыраженияВопроса];
                            
                            var названиеОбстоятельства = описаниеДействия[вопросительноеСлово];
                            
                            if (названиеОбстоятельства =="?") { 
                                continue;
                            }
                            
                            var значимостьПодходящихОбстоятельств = ум.подбериОбстоятельства(названиеОбстоятельства);
                            
                            значимостиПодходящихОбстоятельств[меткаВопроса] = значимостьПодходящихОбстоятельств;
                            
                        }
                        
                        var значимостьПодходящихУтверждений = ум.подбериУтверждения(значимостьПодходящихДействий, значимостиПодходящихОбстоятельств);

                        console.log(значимостьПодходящихУтверждений);

                    }
                    
                }
                
            }
            
        }
        
    }
    
    ум.подбериУтверждения = function(значимостьПодходящихДействий, значимостиПодходящихОбстоятельств) {
        
        var значимостьУтверждений = {};
        
        for (var меткаДействия in значимостьПодходящихДействий) {
            
            var действие = ум.действия[меткаДействия];
            
            var связанныеОбстоятельства = {};

            for (var меткаВопроса in значимостиПодходящихОбстоятельств) {
                
                var значимостиОбстоятельств = значимостиПодходящихОбстоятельств[меткаВопроса];
                
                связанныеОбстоятельства[меткаВопроса] = [];
                
                for (var меткаОбстоятельства in значимостиОбстоятельств) {

                    if (действие.меткиОбстоятельств[меткаВопроса][меткаОбстоятельства] !== undefined) {
                        
                        связанныеОбстоятельства[меткаВопроса].push(меткаОбстоятельства);
                        
                    }
                    
                }

            }
            
            for (var номерМеткиУтверждения = действие.меткиУтверждений.length-1; номерМеткиУтверждения >=0; номерМеткиУтверждения--) {
                
                var меткаУтверждения = действие.меткиУтверждений[номерМеткиУтверждения];
                
                var утверждение = ум.утверждения[меткаУтверждения];
                
                var утверждениеПодходит = 0;

                for (var меткаВопроса in значимостиПодходящихОбстоятельств) {

                    var значимостиОбстоятельств = значимостиПодходящихОбстоятельств[меткаВопроса];

                    for (var меткаОбстоятельства in значимостиОбстоятельств) {

                        if (утверждение.меткиОбстоятельств.indexOf(parseInt(меткаОбстоятельства)) !== -1) {
                            
                            утверждениеПодходит++;
                            
                        }
                        
                    }
                    
                }
                
                if (утверждениеПодходит > 0) {
                    
                    значимостьУтверждений[меткаУтверждения] = утверждениеПодходит;
                    
                }

            }

        }
        
        return значимостьУтверждений;
        
    }
    
    ум.подбериДействия = function(названиеДействия) {
        
        var значимостьВыраженийДействия = ум.подбериВыражения(названиеДействия);
        
        var значимостьПодходящихДействий = {};
        
        for (var меткаВыражения in значимостьВыраженийДействия) {
            
            if (ум.меткиДействий[меткаВыражения] === undefined) {
                continue;
            }
            
            var меткаДействия = ум.меткиДействий[меткаВыражения];
            
            значимостьПодходящихДействий[меткаДействия] = значимостьВыраженийДействия[меткаВыражения];
            
        }
        
        return значимостьПодходящихДействий;
        
    }
    
    ум.подбериОбстоятельства = function(названиеОбстоятельства) {
        
        var значимостьВыраженийеОбстоятельства = ум.подбериВыражения(названиеОбстоятельства);
        
        var значимостьПодходящихОбстоятельств = {};
        
        for (var меткаВыражения in значимостьВыраженийеОбстоятельства) {
            
            if (ум.меткиОбстоятельств[меткаВыражения] === undefined) {
                continue;
            }
            
            var меткаОбстоятельства = ум.меткиОбстоятельств[меткаВыражения];
            
            значимостьПодходящихОбстоятельств[меткаОбстоятельства] = значимостьВыраженийеОбстоятельства[меткаВыражения];
            
        }
        
        return значимостьПодходящихОбстоятельств;
        
    }
    
    ум.подбериВыражения = function(словосочетание) {
        
        словосочетание = словосочетание.replace(/\s+/, " ");

        var наборыБукв = словосочетание.split(" ");
        
        var меткиСлов = [];
        
        for (var номерНабораБукв in наборыБукв) {
            
            var наборБукв = наборыБукв[номерНабораБукв];
            
            if (ум.меткиСлов[наборБукв] === undefined) {
                throw new Error("Вопрос содержит неизвестное слово: " + наборБукв);
            }
            
            var меткаСлова = ум.меткиСлов[наборБукв];
            
            меткиСлов.push(меткаСлова);

        }
        
        var значимостьВыражений = {};
        
        for (var номерМеткиСлова in меткиСлов) {
            
            var меткаСлова = меткиСлов[номерМеткиСлова];
            
            var слово = ум.слова[меткаСлова];
            
            for (var меткаВыражения in слово.меткиВыражений) {
                
                var выражение = ум.выражения[меткаВыражения];
                
                значимостьВыражений[меткаВыражения] = 0;
                
                for (var номерМеткиСловаВВыражении in  выражение.меткиСлов) {
                    
                    var меткаСловаВВыражении = выражение.меткиСлов[номерМеткиСловаВВыражении];
                    
                    if (меткиСлов.indexOf(меткаСловаВВыражении) !== -1) {
                        значимостьВыражений[меткаВыражения]++;
                    }
                    
                }
                
            }
            
        }

        return значимостьВыражений;

    }
    
    // Конец: Чтение данных
    
    // Начало: Запись данных
    
    ум.слушай = function(повествование) {
        
        for (var номер in повествование) {
            
            for (var имяСобеседника in повествование[номер]) {

                var собеседник = ум.узнайСобеседника(имяСобеседника);

                ум.разбериРассказ(собеседник, повествование[номер][имяСобеседника]);

            }
            
        }

    }
    
    ум.узнайВыражение = function(словосочетание) {
      
        словосочетание = ум.обрежьПробелы(словосочетание);
        
        var меткаВыражения;
        
        if (ум.меткиВыражений[словосочетание] === undefined) {
            
            меткаВыражения = ум.меткаНовогоВыражения;
            ум.меткаНовогоВыражения++;
            
            ум.меткиВыражений[словосочетание] = меткаВыражения;
          
            var меткиСлов = [];
            var слова = [];
            var наборыБукв = словосочетание.split(" ");
            for (var номерНабора in наборыБукв) {
                var наборБукв = наборыБукв[номерНабора];
                if (наборБукв.length > 0) {
                    var слово = ум.узнайСлово(наборБукв, меткаВыражения);
                    меткиСлов.push(слово.метка);
                    слова.push(слово);
                }
            }
            if (меткиСлов.length == 0) {
                var слово = ум.узнайСлово("", меткаВыражения);
                меткиСлов.push(слово.метка);
                слова.push(слово);
            }
            for (var номерСлова_1 in слова) {
                var слово_1 = слова[номерСлова_1];
                for (var номерСлова_2 in слова) {
                    var слово_2 = слова[номерСлова_2];
                    if (номерСлова_1 == номерСлова_2) {
                        continue;
                    }
                    if (слово_1.меткиСлов[слово_2.метка] === undefined) {
                        слово_1.меткиСлов[слово_2.метка] = 1;
                    } else {
                        слово_1.меткиСлов[слово_2.метка]++;
                    }
                }
            }
            
            var выражение = {
                метка: меткаВыражения,
                вес: 0,
                меткиСлов: меткиСлов
            };
            
            ум.выражения[меткаВыражения] = выражение;
            
        } else {
            
            меткаВыражения = ум.меткиВыражений[словосочетание];
            
        }
        
        ум.выражения[меткаВыражения].вес++;
        
        return ум.выражения[меткаВыражения];
        
    }
    
    ум.узнайСлово = function(наборБукв, меткаВыражения) {

        var меткаСлова;
        var слово;
        
        if (ум.меткиСлов[наборБукв] === undefined) {
            
            меткаСлова = ум.меткаНовогоСлова;
            ум.меткаНовогоСлова++;
            
            ум.меткиСлов[наборБукв] = меткаСлова;

            слово = {
                метка: меткаСлова,
                вес: 0,
                меткиВыражений: {},
                меткиСлов: {}
            }
            
            ум.слова[меткаСлова] = слово;
            
        } else {
            
            меткаСлова = ум.меткиСлов[наборБукв];
            слово = ум.слова[меткаСлова];
            
        }
        
        слово.вес++;
        
        if (слово.меткиВыражений[меткаВыражения] === undefined) {
            слово.меткиВыражений[меткаВыражения] = 1;
        } else {
            слово.меткиВыражений[меткаВыражения]++;
        }
        
        return слово;
        
    }
    
    ум.узнайСобеседника = function(имяСобеседника) {
        
        var меткаВыражения = ум.узнайВыражение(имяСобеседника).метка;
        
        var меткаСобеседника;
        
        if (ум.меткиСобеседников[меткаВыражения] === undefined) {
            
            меткаСобеседника = ум.меткаНовогоСобеседника;
            ум.меткаНовогоСобеседника++;
            
            ум.меткиСобеседников[меткаВыражения] = меткаСобеседника;

            var собеседник = {
                метка: меткаСобеседника,
                меткаВыражения: меткаВыражения,
                меткиРассказов: []
            }
            
            ум.собеседники[меткаСобеседника] = собеседник;
            
        } else {
            
            меткаСобеседника = ум.меткиСобеседников[меткаВыражения];
            
        }
        
        return ум.собеседники[меткаСобеседника];
        
    }
    
    ум.разбериРассказ = function(собеседник, записьРассказа) {
        
        var рассказ = ум.добавьРассказ(собеседник);
        
        for (var номер in записьРассказа) {
            
            for (var названиеДействия in записьРассказа[номер]) {
                
                var утверждение = ум.добавьУтверждение(рассказ);

                var действие = ум.узнайДействие(названиеДействия, утверждение);

                for (var вопросительноеСлово in записьРассказа[номер][названиеДействия]) {

                    var вопрос = ум.узнайВопрос(вопросительноеСлово);

                    ум.разбериОбстоятельства(записьРассказа[номер][названиеДействия][вопросительноеСлово], собеседник, рассказ, утверждение, действие, вопрос);

                }
                
            }

        }
        
    }

    ум.добавьРассказ = function(cобеседник) {
        
        var меткаРассказа = ум.меткаНовогоРассказа;
        ум.меткаНовогоРассказа++;
        
        var рассказ = {
            метка: меткаРассказа,
            меткаСобеседника: cобеседник.метка,
            меткиУтверждений: [],
            меткиЯвлений: []
        }
        
        ум.рассказы[меткаРассказа] = рассказ;
        
        cобеседник.меткиРассказов.push(меткаРассказа);
        
        return рассказ;
        
    }
    
    ум.добавьУтверждение = function(рассказ) {
        
        var меткаУтверждения = ум.меткаНовогоУтверждения;
        ум.меткаНовогоУтверждения++;
        
        var утверждение = {
            метка: меткаУтверждения,
            меткаРассказа: рассказ.метка,
            меткаДействия: null,
            меткиОбстоятельств: [],
            названияЯвлений: {}
        }

        var рассказНачат = (рассказ.меткиУтверждений.length > 0);
        
        if (рассказНачат) {
            
            // повторяем контекст
            
            var меткаПредыдущегоУтверждения = рассказ.меткиУтверждений[рассказ.меткиУтверждений.length - 1];

            var предыдущееУтверждение = ум.утверждения[меткаПредыдущегоУтверждения];

            for (var меткаВыражения in предыдущееУтверждение.названияЯвлений) {

                var меткаЯвления = предыдущееУтверждение.названияЯвлений[меткаВыражения];
                
                утверждение.названияЯвлений[меткаВыражения] = меткаЯвления;

            }
            
        }

        ум.утверждения[меткаУтверждения] = утверждение;
        
        рассказ.меткиУтверждений.push(меткаУтверждения);
        
        return утверждение;
        
    }
    
    ум.узнайДействие = function(названиеДействия, утверждение) {

        var меткаВыражения = ум.узнайВыражение(названиеДействия).метка;
        
        var меткаДействия;
        
        if (ум.меткиДействий[меткаВыражения] === undefined) {
            
            меткаДействия = ум.меткаНовогоДействия;
            ум.меткаНовогоДействия++;
            
            ум.меткиДействий[меткаВыражения] = меткаДействия;

            var действие = {
                метка: меткаДействия,
                меткаВыражения: меткаВыражения,
                меткиУтверждений: [],
                меткиОбстоятельств: {},
                меткиДействий: {} // меткаОбстоятельства: [меткаДействия_1, ...]
            }
            
            ум.действия[меткаДействия] = действие;
            
        } else {
            
            меткаДействия = ум.меткиДействий[меткаВыражения];
            
        }
        
        ум.действия[меткаДействия].меткиУтверждений.push(утверждение.метка);
        утверждение.меткаДействия = ум.действия[меткаДействия].метка;
        
        return ум.действия[меткаДействия];
        
    }
    
    ум.узнайВопрос = function(вопросительноеСлово) {

        var меткаВыражения = ум.узнайВыражение(вопросительноеСлово).метка;

        var меткаВопроса;
        
        if (ум.меткиВопросов[меткаВыражения] === undefined) {
            
            меткаВопроса = ум.меткаНовогоВопроса;
            ум.меткаНовогоВопроса++;
            
            ум.меткиВопросов[меткаВыражения] = меткаВопроса;

            var вопрос = {
                метка: меткаВопроса,
                меткаВыражения: меткаВыражения,
                меткиОбстоятельств: {}
            }
            
            ум.вопросы[меткаВопроса] = вопрос;
            
        } else {
            
            меткаВопроса = ум.меткиВопросов[меткаВыражения];
            
        }

        return ум.вопросы[меткаВопроса];
        
    }
    
    ум.узнайОбстоятельство = function(названиеОбстоятельства, утверждение, действие, вопрос) {

        var меткаВыражения = ум.узнайВыражение(названиеОбстоятельства).метка;
        
        var меткаОбстоятельства, обстоятельство;
        
        if (ум.меткиОбстоятельств[меткаВыражения] === undefined) {
            
            меткаОбстоятельства = ум.меткаНовогоОбстоятельства;
            ум.меткаНовогоОбстоятельства++;
            
            ум.меткиОбстоятельств[меткаВыражения] = меткаОбстоятельства;

            обстоятельство = {
                метка: меткаОбстоятельства,
                меткаВыражения: меткаВыражения,
                меткиУтверждений: [],
                меткиДействий: {},
                меткиВопросов: {},
                меткиЯвлений: []
            }
            
            ум.обстоятельства[меткаОбстоятельства] = обстоятельство;
            
        } else {
            
            меткаОбстоятельства = ум.меткиОбстоятельств[меткаВыражения];
            
            обстоятельство = ум.обстоятельства[меткаОбстоятельства];
            
        }
        
        // утверждение
        
        обстоятельство.меткиУтверждений.push(утверждение.метка);
        утверждение.меткиОбстоятельств.push(обстоятельство.метка);
        
        if (утверждение.названияЯвлений[обстоятельство.меткаВыражения] !== undefined) {
            
            var меткаЯвления = утверждение.названияЯвлений[обстоятельство.меткаВыражения];
            var явление = ум.явления[меткаЯвления];
            
            явление.меткиУтверждений.push(утверждение.метка);
            
            if (явление.меткиОбстоятельств[обстоятельство.метка] === undefined) {
                явление.меткиОбстоятельств[обстоятельство.метка] = 1;
            } else {
                явление.меткиОбстоятельств[обстоятельство.метка]++;
            }
            
        }
    
        // действие
        
        if (действие.меткиОбстоятельств[вопрос.метка] === undefined) {
            действие.меткиОбстоятельств[вопрос.метка] = {};
        }
        
        if (действие.меткиОбстоятельств[вопрос.метка][обстоятельство.метка] === undefined) {
            действие.меткиОбстоятельств[вопрос.метка][обстоятельство.метка] = 1;
        } else {
            действие.меткиОбстоятельств[вопрос.метка][обстоятельство.метка]++;
        }
        
        if (обстоятельство.меткиДействий[действие.метка] === undefined) {
            обстоятельство.меткиДействий[действие.метка] = 1;
        } else {
            обстоятельство.меткиДействий[действие.метка]++;
        }
        
        // вопрос
        
        if (обстоятельство.меткиВопросов[вопрос.метка] === undefined) {
            обстоятельство.меткиВопросов[вопрос.метка] = 1;
        } else {
            обстоятельство.меткиВопросов[вопрос.метка]++;
        }
        
        if (вопрос.меткиОбстоятельств[обстоятельство.метка] === undefined) {
            вопрос.меткиОбстоятельств[обстоятельство.метка] = 1;
        } else {
            вопрос.меткиОбстоятельств[обстоятельство.метка]++;
        }
        
        return обстоятельство;
        
    }
    
    ум.разбериОбстоятельства = function(названияОбстоятельств, собеседник, рассказ, утверждение, действие, вопрос) {

        if (typeof названияОбстоятельств === "string") {
            названияОбстоятельств = [названияОбстоятельств];
        }

        for (var номер in названияОбстоятельств) {

            var названиеОбстоятельства = null;
            var поисковоеЗадание = null;
            var обстоятельство = null;
 
            var присутствуетСссылка = (названияОбстоятельств[номер].indexOf("(") !== -1);

            if (присутствуетСссылка) {

                названиеОбстоятельства = названияОбстоятельств[номер].substring(0, названияОбстоятельств[номер].indexOf("("));

                обстоятельство = ум.узнайОбстоятельство(названиеОбстоятельства, утверждение, действие, вопрос);

                поисковоеЗадание = названияОбстоятельств[номер].substring(названияОбстоятельств[номер].indexOf("(") + 1, названияОбстоятельств[номер].indexOf(")"));

                ум.поймиСсылку(поисковоеЗадание, обстоятельство, собеседник, рассказ, утверждение, действие);

            } else {

                названиеОбстоятельства = названияОбстоятельств[номер];

                обстоятельство = ум.узнайОбстоятельство(названиеОбстоятельства, утверждение, действие, вопрос);


            }

        }
        
    }
    
    ум.поймиСсылку = function(поисковоеЗадание, обстоятельство, собеседник, рассказ, утверждение, действие) {

        var найдено = ум.найдиПоследнееУпотребление(собеседник, поисковоеЗадание);
        
        if (найдено.действие !== undefined) {
            
            if (действие.меткиДействий[обстоятельство.метка] === undefined) {
                действие.меткиДействий[обстоятельство.метка] = [];
            }
            
            if (!(найдено.действие.метка in действие.меткиДействий[обстоятельство.метка])) {
                действие.меткиДействий[обстоятельство.метка].push(найдено.действие.метка);
            }

        } else if (найдено.обстоятельство !== undefined) {
            
            var явлениеУпоминалосьВРассказе = (найдено.утверждение.названияЯвлений[найдено.обстоятельство.меткаВыражения] !== undefined);

            if (явлениеУпоминалосьВРассказе) {
                
                var меткаЯвления = найдено.утверждение.названияЯвлений[найдено.обстоятельство.меткаВыражения];

                var явление = ум.явления[меткаЯвления];

            } else {
                
                var явление = ум.добавьЯвление(рассказ, найдено.утверждение, найдено.обстоятельство);

                найдено.утверждение.названияЯвлений[найдено.обстоятельство.меткаВыражения] = явление.метка;
                утверждение.названияЯвлений[найдено.обстоятельство.меткаВыражения] = явление.метка;

            }
            
            явление.меткиУтверждений.push(утверждение.метка);

            утверждение.названияЯвлений[обстоятельство.меткаВыражения] = явление.метка;
            
            if (явление.меткиОбстоятельств[обстоятельство.метка] === undefined) {
                явление.меткиОбстоятельств[обстоятельство.метка] = 1;
            } else {
                явление.меткиОбстоятельств[обстоятельство.метка]++;
            }

        } else {

            throw new Error("В ссылке ошибка 2: " + поисковоеЗадание);

        }
        
    }
    
    ум.найдиПоследнееУпотребление = function(собеседник, поисковоеЗадание) {
        
        var поисковыеВыражения = поисковоеЗадание.split(",");
        var главноеВыражение = null;
        var уточняющиеВыражения = [];
        var меткаГлавногоВыражения = null;
        var меткаУточняющегоВыражения = null;
        
        for (var номер in поисковыеВыражения) {
            
            поисковыеВыражения[номер] = ум.обрежьПробелы(поисковыеВыражения[номер]);

            if (ум.меткиВыражений[поисковыеВыражения[номер]] === undefined) {
                throw new Error("В ссылке ошибка 1: " + поисковоеЗадание);
            }
            
            if (номер == 0) {
                меткаГлавногоВыражения = ум.меткиВыражений[поисковыеВыражения[номер]];
                главноеВыражение = ум.выражения[меткаГлавногоВыражения];
                
            } else {
                меткаУточняющегоВыражения = ум.меткиВыражений[поисковыеВыражения[номер]];
                уточняющиеВыражения.push(ум.выражения[уточняющиеВыражения]);
            }
            
        }
        
        
        var номерПоследенегоРассказа = собеседник.меткиРассказов.length - 1;
        
        for (var номерРассказа = номерПоследенегоРассказа; номерРассказа >= 0; номерРассказа--) {
            
            var меткаРассказа = собеседник.меткиРассказов[номерРассказа];
            
            var рассказ = ум.рассказы[меткаРассказа];
            
            var меткаПоследнегоУтверждения = рассказ.меткиУтверждений.length - 1;
          
            for (var номерУтверждения = меткаПоследнегоУтверждения; номерУтверждения >= 0; номерУтверждения--) {
                
                var меткаУтверждения = рассказ.меткиУтверждений[номерУтверждения];
                
                var утверждение = ум.утверждения[меткаУтверждения];

                var найдено = ум.найдиВыражениеВУтверждении(утверждение, главноеВыражение, уточняющиеВыражения);
                
                if (найдено.действие || найдено.обстоятельство) {

                    return найдено;
                    
                }

            }
            
        }
        
        return {};
        
    }
    
    ум.найдиВыражениеВУтверждении = function(утверждение, выражение, уточняющиеВыражения) {
        
        var действие = ум.действия[утверждение.меткаДействия];
        
        if (действие.меткаВыражения === выражение.метка) {
            
            return {
                "действие": действие,
                "утверждение": утверждение
            }
            
        } else {
            
            var номерПоследнегоОбстоятельства = утверждение.меткиОбстоятельств.length - 1;
            
            for (var номерОбстоятельства = номерПоследнегоОбстоятельства; номерОбстоятельства >= 0; номерОбстоятельства--) {
                
                var меткаОбстоятельства = утверждение.меткиОбстоятельств[номерОбстоятельства];
                
                var обстоятельство = ум.обстоятельства[меткаОбстоятельства];

                if (обстоятельство.меткаВыражения === выражение.метка) {
                    
                    return {
                        "обстоятельство": обстоятельство,
                        "утверждение": утверждение
                    }
                    
                }
                
            }
            
        }
        
        return {};
        
    }
    
    ум.добавьЯвление = function(рассказ, утверждение, обстоятельство) {
        
        var меткаЯвления = ум.меткаНовогоЯвления;
        ум.меткаНовогоЯвления++;
        
        var явление = {
            метка: меткаЯвления,
            меткиЯвлений: {}, // на случай упоминания одного и того же явления другими собеседниками или в других рассказах
            меткиОбстоятельств: {},
            меткиУтверждений: [утверждение.метка]
        }
        
        явление.меткиОбстоятельств[обстоятельство.метка] = 1;
        
        ум.явления[меткаЯвления] = явление;
        
        утверждение.названияЯвлений[обстоятельство.меткаВыражения] = явление.метка;
        
        рассказ.меткиЯвлений.push(явление.метка);
        
        return явление;
        
    }
    
    ум.обрежьПробелы = function(строка) {
       
        строка = строка.replace(/\s+/, " ");
        строка = строка.replace(/\s*$/, "");
        строка = строка.replace(/^\s*/, "");
        
        return строка;
        
    }
    
    // Конец: Запись данных
    
    return {
        слушай: ум.слушай,
        говори: ум.говори,
        ответь: ум.ответь
    }
    
})();

ум.слушай([
    {"Эно Рауд": [
        {"встретились": {
            "когда": "однажды",
            "где": "у киоска с мороженым",
            "как": "случайно",
            "кто": "трое накситраллей"
        }},
        {"был": {
            "где": "среди них(трое накситраллей)",
            "кто": [
                "Моховая Борода", 
                "Полботинка", 
                "Муфта"
            ]
        }},
        {"были": {
            "кто": "они(трое накситраллей)",
            "какие": "маленького роста"
        }},
        {"прияняла": {
            "кто": "мороженщица",
            "кого": "их(трое накситраллей)",
            "когда": "поначалу",
            "за кого": "за гномов",
            "почему": "потому что(были, маленького роста)"
        }},
        {"были": {
            "у кого": "у каждого из них(трое накситраллей)",
            "что": "другие занянтые чёрточки"
        }},
        {"была": {
            "у кого": "Моховой Бороды(Моховая Борода)",
            "что": "борода из мягкого мха"
        }},
        {"росли": {
            "где": "в ней(борода из мягкого мха)",
            "что": ["хоть и прошлогодние", "но всё равно прекрасные ягоды брусники"]
        }},
        {"был обут": {
            "кто": "Полботинка(Полботинка)",
            "во что": "в ботинки с обрезанными носами"
        }},
        {"было": {
            "как": "так(был обут)",
            "что": "удобнее шевилить пальцами"
        }},
        {"носил": {
            "кто": "Муфта(Муфта)",
            "вместо чего": "обычной одежды",
            "что": "толстую муфту"
        }},
        {"торчали": {
            "откуда": "из котрой(толстую муфту)",
            "что": ["макушка", "пятки"]
        }},
        {"ели": {
            "кто": "они(трое накситраллей)",
            "что": "мороженое"
        }},
        {"разглядывали": {
            "кто": "они",
            "как": "с большим любопытством",
            "кого": "друг друга"
        }}
    ]},
    {"Муфта": [
        {"извините": {}}
    ]},
    {"Эно Рауд": [
        {"сказал": {
            "кто": "Муфта",
            "когда": "наконец"
        }}
    ]},
    {"Муфта": [
        {"ошибаюсь": {
            "кто": "я",
            "насколько": ["возможно", "конечно"]
        }},
        {"есть": {
            "в ком": "в нас",
            "что": "что-то общее"
        }},
        {"сдаётся": {
            "кому": "мне(я)",
            "что": "есть, что-то общее"
        }}
    ]},
    {"Полботинка": [
        {"показалось": {
            "кому": "мне",
            "что": "так"
        }}
    ]},
    {"Эно Рауд": [
        {"кивнул": {
            "кто": "Полботинка"
        }},
        {"отщипнул": {
            "кто": "Моховая Борода",
            "откуда": "с бороды",
            "что": "несколько ягод"
        }},
        {"протянул": {
            "кто": "он(Моховая Борода)",
            "кому": "новым знакомым"
        }}
    ]},
    {"Моховая Борода": [
        {"": {
            "как": "хорошо",
            "что": "кисленькое",
            "к чему": "к мороженому"
        }}
    ]},
    {"Муфта": [
        {"боюсь показаться": {
            "каким": "навязчивым"
        }},
        {"собраться": {
            "когда": "ещё как-нибудь"
        }},
        {"было бы": {
            "как": "славно",
            "что": "это(собраться)"
        }}
    ]},
    {"Эно Рауд": [
        {"сказал": {
            "кто": "Муфта"
        }}
    ]},
    {"Муфта": [
        {"сварили бы": {
            "что": "какао"
        }},
        {"побеседовали бы": {
            "о чём": "о том о сём"
        }}
    ]},
    {"Полботинка": [
        {"было бы": {
            "что": "это",
            "как": "замечательно"
        }}
    ]},
    {"Эно Рауд": [
        {"обрадоваля": {
            "кто": "Полботинка"
        }}
    ]},
    {"Полботинка": [
        {"пригласил бы": {
            "как": "охотно",
            "кого": "вас",
            "куда": "к себе"
        }},
        {"но нет": {
            "у кого": "у меня",
            "чего": "дома"
        }},
        {"путешествовал": {
            "кто": "я(у меня)",
            "когда": "с самого детства",
            "где": "по белу свету"
        }}
    ]},
    {"Моховая Борода": [
        {"": {
            "как кто": "я",
            "как": "ну совсем"
        }}
    ]},
    {"Эно Рауд": [
        {"сказал": {
            "кто": "Моховая Борода"
        }}
    ]},
    {"Муфта": [
        {"": {
            "что": "какое совпадение",
            "": "надо же"
        }}
    ]},
    {"Эно Рауд": [
        {"воскликнул": {
            "кто": "Муфта"
        }}
    ]},
    {"Муфта": [
        {"": {
            "с кем": "со мной",
            "что": "точно такая же история"
        }},
        {"являемся": {
            "кто": "все мы",
            "кем": "путешественниками",
            "": "стало быть"
        }}
    ]},
    {"Эно Рауд": [
        {"бросил": {
            "кто": "Муфта",
            "что": "бумажку от мороженного",
            "куда": "в мусорный ящик"
        }},
        {"застегнул": {
            "кто": "он(Муфта)",
            "что": "молнию на муфте"
        }},
        {"было": {
            "у чего": "у его муфты",
            "что": "такое свойство"
        }}
    ]}

]);

ум.говори("Иванов");

ум.слушай([
    {"Эно Рауд": [
        {"бросил": {
            "кто": "Муфта",
            "что": "бумажку от мороженного",
            "куда": "в мусорный ящик"
        }}
    ]}
]);

ум.ответь([
    {"*": [
        {"бросил": {
            "кто": "Муфта",
            "куда": "в ящик"
        }}
    ]}
]);

</script>
</head>
</html>